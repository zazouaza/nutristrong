apiVersion: v1
kind: ConfigMap
metadata:
  name: varnish-config
data:
  default.vcl: |
    vcl 4.0;

    backend default {
      .host = "backend";
      .port = "3001";
    }

    sub vcl_recv {
      # Only cache GET requests
      if (req.method != "GET" && req.method != "HEAD") {
        return (pass);
      }
      
      # Don't cache authenticated requests (simple check for Authorization header)
      if (req.http.Authorization) {
        return (pass);
      }

      return (hash);
    }

    sub vcl_backend_response {
      # Cache for 1 hour by default
      set beresp.ttl = 1h;
    }
